import pdb

from PyPDF2 import PdfReader

reader = PdfReader("caderneta.pdf")
text = ""
for page in reader.pages:
    text += page.extract_text() + "\n"


data_raw = text.replace("\t", "\n").splitlines()

print(data_raw)


data = {}

for i, line in enumerate(data_raw):
    if "Descrição:" in line:
        data["descricao"] = line.split(":")[1].strip().lower()
    elif "ARTIGO MATRICIAL" in line:

        data["artigo_matricial"] = line.split("Nº:")[1].split()[0].strip()
    elif "Área Total (ha):" in line:
        data["area"] = str(
            int(float(line.split(":")[1].strip().replace(",", ".")) * 10000)
        )
    elif "NOME/LOCALIZAÇÃO PRÉDIO" in line:
        j = i + 1
        while data_raw[j] in "":
            j += 1
        data["localizacao"] = data_raw[j]

    elif "TEVE ORIGEM NOS ARTIGOS" in line:
        j = i + 1
        while data_raw[j] in "":
            j += 1
        data["artigo_origem"] = data_raw[j].split("Artigo:")[1].split()[0]
    elif "IDENTIFICAÇÃO DO PRÉDIO" in line:
        j = i + 1
        while data_raw[j] in "":
            j += 1
        if not "SECÇÃO:" in data_raw[j + 1]:
            data_raw[j] += " " + data_raw[j + 1]
        data["freguesia"] = data_raw[j].split("-")[-1].strip()
        data["conselho"] = "".join(data_raw[j].split("-")[2].split()[:-2])

    elif "Valor Patrimonial Actual" in line:
        data["valor_actual"] = line.split(":")[1].split("Determinado")[0].strip()

    elif "CONFRONTAÇÕES DO PRÉDIO" in line:
        confrontacoes = ""
        j = i + 1
        while "ELEMENTOS DO PRÉDIO" not in data_raw[j]:
            confrontacoes += data_raw[j]
            j += 1
        data["norte"] = confrontacoes.split("Norte:")[1].split("Sul:")[0].strip()
        data["Sul"] = confrontacoes.split("Sul:")[1].split("Nascente:")[0].strip()
        data["Nascente"] = (
            confrontacoes.split("Nascente:")[1].split("Poente:")[0].strip()
        )
        data["poente"] = confrontacoes.split("Poente:")[1].strip()


print(data)
